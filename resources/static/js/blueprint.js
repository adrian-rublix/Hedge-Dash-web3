mintAddress = '0x905D8dbdF4C06Fb2Fd7C6D1376A2Af6d6C6A6d4C';
mintAbi = [{"constant":true,"inputs":[],"name":"creator","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address[]"},{"name":"_value","type":"uint256[]"}],"name":"transferMulti","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"}],"name":"decreaseApproval","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"}],"name":"increaseApproval","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"initialSupply","type":"uint256"},{"name":"_creator","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"}];

//factoryAddress = '0x457B1EF2bb7EA1Dc864fa55728985753b6882f56';
factoryAddress = '0x13cB939F7efAbA6498CdCAB363D9D4FCeeFA2B06';
//factoryAbi = [{"constant":true,"inputs":[{"name":"_userID","type":"uint256"}],"name":"lookupUserMeta","outputs":[{"name":"userAddress","type":"address"},{"name":"totalAmountSpent","type":"uint256"},{"name":"noOfBlueprintsCreated","type":"uint256"},{"name":"noOfBlueprintsPurchased","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"creationPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_blueprintID","type":"uint256"}],"name":"lookupBlueprintMeta","outputs":[{"name":"ticker","type":"string"},{"name":"creationTimestamp","type":"uint256"},{"name":"expirationTimestamp","type":"uint256"},{"name":"blueprintAddress","type":"address"},{"name":"creatorID","type":"uint256"},{"name":"creatorAddress","type":"address"},{"name":"noOfBuyers","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_walletAddresses","type":"address[]"}],"name":"removeValidatedUsers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_walletAddresses","type":"address[]"}],"name":"reValidateUsers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"blueprintID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"rblxOracleAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_blueprintAddress","type":"address"}],"name":"purchaseBlueprint","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_walletAddresses","type":"address[]"}],"name":"addValidatedUsers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_ticker","type":"string"},{"name":"_entryTkrPrice","type":"uint256"},{"name":"_exitTkrPrice","type":"uint256"},{"name":"_expirationTimestamp","type":"uint256"}],"name":"createBlueprint","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_purchasePrice","type":"uint256"}],"name":"changePurchasePrice","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"purchasePrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_creationPrice","type":"uint256"}],"name":"changeCreationPrice","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"rblxToken","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"userID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_rblxOracleAddress","type":"address"}],"name":"changeOracleAddress","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"_rblxTokenAddress","type":"address"},{"name":"_rblxOracleAddress","type":"address"},{"name":"_creationPrice","type":"uint256"},{"name":"_purchasePrice","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"creator","type":"address"},{"indexed":false,"name":"blueprint","type":"address"}],"name":"BlueprintCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"buyer","type":"address"},{"indexed":false,"name":"blueprint","type":"address"}],"name":"BlueprintPurchased","type":"event"}];

factoryAbi = [{"constant":true,"inputs":[],"name":"noOfUsers","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_userID","type":"uint256"}],"name":"lookupUserMeta","outputs":[{"name":"userAddress","type":"address"},{"name":"totalAmountSpent","type":"uint256"},{"name":"totalAmountReturned","type":"uint256"},{"name":"noOfBlueprintsCreated","type":"uint256"},{"name":"noOfBlueprintsPurchased","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"creationPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_blueprintID","type":"uint256"}],"name":"claimReturns","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_blueprintID","type":"uint256"}],"name":"lookupBlueprintMeta","outputs":[{"name":"blueprintAddress","type":"address"},{"name":"ticker","type":"string"},{"name":"margin","type":"uint256"},{"name":"expirationTimestamp","type":"uint256"},{"name":"creationTimestamp","type":"uint256"},{"name":"creatorID","type":"uint256"},{"name":"creatorAddress","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_walletAddresses","type":"address[]"}],"name":"removeValidatedUsers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_walletAddresses","type":"address[]"}],"name":"reValidateUsers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"blueprintID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_walletAddresses","type":"address[]"}],"name":"addValidatedUsers","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_ticker","type":"string"},{"name":"_entryTkrPrice","type":"uint256"},{"name":"_exitTkrPrice","type":"uint256"},{"name":"_expirationTimestamp","type":"uint256"}],"name":"createBlueprint","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_blueprintID","type":"uint256"}],"name":"purchaseBlueprint","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_purchasePrice","type":"uint256"}],"name":"changePurchasePrice","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"noOfBlueprints","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"purchasePrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_creationPrice","type":"uint256"}],"name":"changeCreationPrice","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"userID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_rblxOracleAddress","type":"address"}],"name":"changeOracleAddress","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"_rblxTokenAddress","type":"address"},{"name":"_rblxOracleAddress","type":"address"},{"name":"_creationPrice","type":"uint256"},{"name":"_purchasePrice","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"creator","type":"address"},{"indexed":false,"name":"blueprint","type":"address"},{"indexed":false,"name":"creationPrice","type":"uint256"}],"name":"BlueprintCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"buyer","type":"address"},{"indexed":false,"name":"blueprint","type":"address"},{"indexed":false,"name":"purchasePrice","type":"uint256"}],"name":"BlueprintPurchased","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"receipiant","type":"address"},{"indexed":false,"name":"blueprint","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"ReturnClaimed","type":"event"}];

//blueprintAbi = blueprintAbi = [{"constant":true,"inputs":[],"name":"creationPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"refundPurchase","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_periodHigh","type":"uint256"},{"name":"_highTimestamp","type":"uint256"},{"name":"_periodLow","type":"uint256"},{"name":"_lowTimestamp","type":"uint256"}],"name":"confirmPrediction","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"source","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"buyerID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"blueprintID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ticker","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"emptyUnclaimedTokens","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"expirationTimestamp","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"creatorID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oracleAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"creationTimestamp","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastBuyerID","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_buyerAddress","type":"address"}],"name":"addBuyer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"purchasePrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"viewPrediction","outputs":[{"name":"entryTkrPrice_","type":"uint256"},{"name":"exitTkrPrice_","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"rblxToken","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"creatorAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"buyers","outputs":[{"name":"buyerAddress","type":"address"},{"name":"amountStaked","type":"uint256"},{"name":"amountRefunded","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_creatorAddress","type":"address"},{"name":"_creatorID","type":"uint256"},{"name":"_blueprintID","type":"uint256"},{"name":"_purchasePrice","type":"uint256"},{"name":"_creationPrice","type":"uint256"},{"name":"_ticker","type":"string"},{"name":"_entryTkrPrice","type":"uint256"},{"name":"_exitTkrPrice","type":"uint256"},{"name":"_creationTimestamp","type":"uint256"},{"name":"_expirationTimestamp","type":"uint256"},{"name":"_oracleAddress","type":"address"},{"name":"_rblxToken","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"Previous","type":"uint8"},{"indexed":false,"name":"New","type":"uint8"}],"name":"StateChange","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"receipiant","type":"address"},{"indexed":false,"name":"blueprint","type":"address"},{"indexed":false,"name":"amountRefunded","type":"uint256"}],"name":"RefundClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"blueprint","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"BlueprintEmptied","type":"event"}];


function createBlueprint() {

    if (contractCreationPrice > amountApproved){
        amountToApprove = prompt("To create or purchase blueprints, please increase the allowed spending amount of the Blueprint Factory.",100);
        mintContract.increaseApproval.sendTransaction(factoryAddress,amountToApprove, {from: metaAccount}, function(error, result) {
            if (!error) {
                alert("Funds approved!")
            } else {
                alert("Error: Could not access Token Contract increaseApproval function.");
            }
        });
    } else {

        ticker_ = document.getElementById('ticker').value;

        entryPrice_ = document.getElementById('entryPrice').value;
        exitPrice_ = document.getElementById('exitPrice').value;

        date_ = document.getElementById('dateExipre').value;
                        
        timestamp_ = new Date(date_).getTime()/1000;
                        
        factoryContract.createBlueprint.sendTransaction(ticker_, entryPrice_, exitPrice_, timestamp_, {from: metaAccount}, function(error, result) {
        
            if (!error) {
                alert('ok!')                          
            } else {
                alert("Error: Could not deploy Blueprint."); 
            }
        });
    }
}

function purchaseBlueprint(blueprintID) {
 

    if (contractPurchasePrice > amountApproved){
        amountToApprove = prompt("To create or purchase blueprints, please increase the allowed spending amount of the Blueprint Factory.",100);
        mintContract.increaseApproval.sendTransaction(factoryAddress,amountToApprove, {from: metaAccount}, function(error, result) {
            if (!error) {
                alert("Funds approved!")
            } else {
                alert("Error: Could not access Token Contract increaseApproval function.");
            }
        });
    } else {

         //blueprintContract = web3.eth.contract(blueprintAbi).at(blueprintAddress);
         
         factoryContract.purchaseBlueprint.sendTransaction(blueprintID, {from: metaAccount}, function(error, result) {
        
            if (!error) {
                alert('ok!')                          
            } else {
                alert("Error: Could not purchase Blueprint."); 
            }
        });
    }
}




